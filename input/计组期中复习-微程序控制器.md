---
title: 计组期中复习-微程序控制器
date: 2024-04-14 14:48:48
tags: 计组
---
![微程序控制器补全代码](../img/计组/微程序控制器补全代码.png)
怎么理解指令和微指令呢？大概就是微指令从指令中拆分出具体的很小的一个单位步骤，指令分为两个字节。前一个字节的前4位是操作码，后四位是寄存器号或者0000（像JMP没有寄存器所以就直接0000），第二个字节**一定**是存储单元地址（所以之前有一道选择题说能不能是寄存器+寄存器呢？对不起，不行，必须要有一个地址。
在这里设计的四条指令分别是：
1. ADD R, M
◦ 功能： 将R的内容与M中的内容相加后存入R
2. LOAD R, M
◦ 功能： 将M中的内容装入R
3. STORE M, R
◦ 功能： 将R的内容存入M中
4. JMP L
◦ 功能： 无条件转向L处

注： M和L为存储器地址， R为寄存器编号

# 取指令
每条指令的T1周期， 都要发出PC_OUT、 MAR_IN、 M_读和PC_加共四个信号。这条微指令形式的信号序列如下：1111000000000000
每条指令的T2周期， 都要发MDR_OUT、 IR_IN两个信号这条微指令形式的信号序列如下：0000110000000000
![T1和T2](../img/计组/T1和T2.jpg)
故T2的微操作字段为0000110000000000，下址字段不是像T1周期执行完之后无脑下一步（毕竟T1释放了PC+信号，但是T2不是直接PC+，而是要看这个指令具体在哪里。从T1机器周期就开始传递的这个数据正是下一个要执行的指令地址。

下址字段为1xx10

最高位的1
意义：这通常表明，接下来的微指令将发生一个条件性的跳转。也就是说，CPU的下一步行动并不是简单地执行下一个顺序的微指令地址，而是根据某个条件来决定跳转的目标地址。（该例为执行IR寄存器中的内容（指令地址（指令寄存器

中间的xx
意义：这部分通常代表指令的操作码，它用于指示当前执行的指令类型。在微程序设计中，这可以用于基于正在执行的机器指令来选择相应的微指令流程。
例子：如果“xx”是从指令寄存器（IR）中解析出的当前机器指令的部分字段（比如操作码），这可以用来决定执行哪一组微指令。（load为00，add为01，store为10，jmp为11）

![答案](../img/计组/答案.png)
最后的10
其实也很好理解。因为不管是LOAD, ADD, STORE, 还是JMP，他们的“第一个”（图中是T3）的地址的后两位都是10（注意机器周期从开1始算，但是地址从0开始算

最上面那个取指令对于所有的指令LOAD, ADD, STORE, JMP都适用（即，分别取LOAD, ADD, ...）都要从第一个机器周期开始算。因为不管是哪个指令首先都得从PC取出来，所以他们在T1和T2的步骤是一样的。

# LOAD R, M

然后就是LOAD指令在T3和T4的机器周期干了什么

先来看看LOAD指令在所有的周期干了什么吧
指令“LOAD R1, M1”的执行过程：
**① 取指令并形成下一条指令的地址（所有指令通用**
I. 控制器发“PCOUT” 和“MARIN” 信号， 使PC→MAR
II. 控制器发“M读” 信号， 使存储器的内容（指令） →MDR
III. 控制器发“PC加” 信号， 使PC+n→PC， 其中n为该指令占用的地址数
IV. 控制器发“MDROUT” 和“IRIN” 信号， 使MDR→IR

（上面的都干过了）

**② 执行指令“LOAD R1, M1”**
I. 控制器发“IROUT” 和“MARIN” 信号， 使IR中指令的地址段（即M1） →MAR
II. 控制器发“M读” 信号， 使存储器M1的内容（数据） →MDR
III. 控制器发“MDROUT” 和“R1IN” 信号， 使MDR→R1

我们重点关注②。LOAD R, M的功能是将M中的内容装入R。
I和II组合组成了T3：0110 0010 0000 0000
（注意MDRin没有用到，把指令读到MDR的指令是M读，而不是MDRIN
因为load还没执行完，所以下址字段无条件跳转到LOAD的下一个周期所在微地址0011（最高位的0标志无条件跳转）

III就是T4，因为此时LOAD的核心功能已经完成，所以下址字段为End指令所在位置。

# ADD R, M
（省略取指令步骤
>执行指令“ADD R1,M2”
I. 控制器发“IROUT” 和“MARIN” 信号， 使IR中指令的地址段（ 即M2） →MAR
II. 控制器发“M读” 信号， 使存储器M2的内容（数据） →MDR，通过DBUS
III. 控制器发“MDROUT” 和“YIN” 信号， 使MDR→Y（ 即ALU的A端）
IV. 控制器发“R1OUT” ， 使R1→内部总线（ 即ALU的B端）
V. 控制器发“add” 信号， 使A+B→Z
VI. 控制器发“ZOUT” 和“R1IN” 信号， 使Z→R1

这么冗长的步骤我也记不住啊，，一条条分解吧

ADD R,M的核心功能是把M中的内容取出来与R相加再存入R中。
M从哪来？
IR指令中来，指令中包含了所求地址，所以IR_OUT,它现在在总线，我再MAR_IN一下。（MAR和MDR的区别是，一个存的是这个地址，一个存的是地址的内容

我怎么读出这个M中的内容呢？（因为是内容相加而不是地址相加）那好办，M_读一下，MAR寄存器中存的地址**的内容**就到总线去了。然后把总线的内容通过MDRIN就可以读入MDR了

--to be continued